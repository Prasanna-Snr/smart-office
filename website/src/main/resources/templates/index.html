<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Office - Dashboard</title>
    <link rel="stylesheet" th:href="@{/static/css/style.css}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">
                    <span class="material-icons">business</span>
                    Smart Office
                </h1>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openUserManagement()">
                        <span class="material-icons">people</span>
                        User Management
                    </button>
                </div>
            </div>
        </header>

        <!-- Gas Detection Alert -->
        <div id="gasAlert" class="alert alert-danger" style="display: none;">
            <div class="alert-content">
                <span class="material-icons">warning</span>
                <div class="alert-text">
                    <strong>Gas Detected!</strong>
                    <p>Dangerous gas levels detected. Please evacuate immediately.</p>
                </div>
                <button class="btn btn-sm btn-light" onclick="dismissGasAlert()">Dismiss</button>
            </div>
        </div>

        <!-- Garbage Level Alert -->
        <div id="garbageAlert" class="alert" style="display: none;">
            <div class="alert-content">
                <span class="material-icons">delete</span>
                <div class="alert-text">
                    <strong id="garbageAlertTitle">Garbage Level Warning</strong>
                    <p id="garbageAlertMessage">Dustbin needs attention</p>
                </div>
                <button class="btn btn-sm btn-light" onclick="dismissGarbageAlert()">Dismiss</button>
            </div>
        </div>

        <!-- Main Dashboard -->
        <main class="dashboard">
            <!-- Camera Feed Section -->
            <section class="camera-section">
                <div class="card">
                    <div class="card-header">
                        <h3><span class="material-icons">videocam</span> Live Camera Feed</h3>
                    </div>
                    <div class="card-body">
                        <div class="camera-container">
                            <video id="cameraFeed" autoplay muted></video>
                            <div class="camera-overlay">
                                <button class="btn btn-primary" onclick="capturePhoto()">
                                    <span class="material-icons">camera_alt</span>
                                    Capture Photo
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Controls Grid -->
            <div class="controls-grid">
                <!-- Door Control -->
                <div class="card">
                    <div class="card-header">
                        <h3><span class="material-icons">door_front</span> Door Control</h3>
                    </div>
                    <div class="card-body">
                        <div class="door-status">
                            <div class="status-badge" id="doorStatusBadge">
                                <div class="status-dot"></div>
                                <span id="doorStatusText">CLOSED</span>
                            </div>
                        </div>
                        <div class="button-group">
                            <button class="btn btn-success" id="openDoorBtn" onclick="toggleDoor(true)">Open</button>
                            <button class="btn btn-danger" id="closeDoorBtn" onclick="toggleDoor(false)">Close</button>
                        </div>
                    </div>
                </div>

                <!-- Device Controls -->
                <div class="card">
                    <div class="card-header">
                        <h3><span class="material-icons">settings</span> Device Controls</h3>
                    </div>
                    <div class="card-body">
                        <div class="device-control">
                            <div class="control-item">
                                <div class="control-info">
                                    <span class="material-icons">lightbulb</span>
                                    <div>
                                        <h4>Office Lights</h4>
                                        <p id="lightStatus">Currently OFF</p>
                                    </div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="lightSwitch" onchange="toggleLight()">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="control-item">
                                <div class="control-info">
                                    <span class="material-icons">air</span>
                                    <div>
                                        <h4>Ceiling Fan</h4>
                                        <p id="fanStatus">Currently OFF</p>
                                    </div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="fanSwitch" onchange="toggleFan()">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Temperature Widget -->
                <div class="card">
                    <div class="card-header">
                        <h3><span class="material-icons">thermostat</span> Temperature</h3>
                    </div>
                    <div class="card-body">
                        <div class="temperature-display">
                            <div class="temp-value" id="temperatureValue">22.0°C</div>
                            <div class="temp-range">Optimal: 20-25°C</div>
                            <div class="temp-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="temperatureProgress"></div>
                                </div>
                                <div class="progress-labels">
                                    <span>15°C</span>
                                    <span>35°C</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Garbage Level -->
                <div class="card">
                    <div class="card-header">
                        <h3><span class="material-icons">delete</span> Garbage Level</h3>
                    </div>
                    <div class="card-body">
                        <div class="garbage-gauge">
                            <div class="gauge-container">
                                <svg class="gauge-svg" viewBox="0 0 200 120">
                                    <!-- Background arc -->
                                    <path d="M 20 100 A 80 80 0 0 1 180 100" 
                                          fill="none" 
                                          stroke="#e0e0e0" 
                                          stroke-width="12"/>
                                    <!-- Progress arc -->
                                    <path id="garbageProgressArc" 
                                          d="M 20 100 A 80 80 0 0 1 180 100" 
                                          fill="none" 
                                          stroke="#4CAF50" 
                                          stroke-width="12"
                                          stroke-dasharray="251.2"
                                          stroke-dashoffset="188.4"/>
                                    <!-- Needle -->
                                    <line id="garbageNeedle" 
                                          x1="100" y1="100" 
                                          x2="100" y2="30" 
                                          stroke="#333" 
                                          stroke-width="2"/>
                                    <circle cx="100" cy="100" r="4" fill="#333"/>
                                </svg>
                                <div class="gauge-text">
                                    <div class="gauge-percentage" id="garbagePercentage">45%</div>
                                    <div class="gauge-status" id="garbageStatus">Normal (Sensor)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Office Statistics -->
                <div class="card">
                    <div class="card-header">
                        <h3><span class="material-icons">analytics</span> Office Statistics</h3>
                    </div>
                    <div class="card-body">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="material-icons">people</span>
                                <div>
                                    <div class="stat-value" id="userCount">0</div>
                                    <div class="stat-label">Total Users</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <span class="material-icons">thermostat</span>
                                <div>
                                    <div class="stat-value" id="tempStat">22.0°C</div>
                                    <div class="stat-label">Temperature</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <span class="material-icons">delete</span>
                                <div>
                                    <div class="stat-value" id="garbageStat">45%</div>
                                    <div class="stat-label">Garbage Level</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- User Management Modal -->
        <div id="userModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>User Management</h2>
                    <button class="close-btn" onclick="closeUserManagement()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="user-actions">
                        <button class="btn btn-primary" onclick="showAddUserForm()">
                            <span class="material-icons">add</span>
                            Add New User
                        </button>
                        <button class="btn btn-secondary" onclick="verifyFace()">
                            <span class="material-icons">face</span>
                            Verify Face
                        </button>
                    </div>
                    
                    <!-- Add User Form -->
                    <div id="addUserForm" class="user-form" style="display: none;">
                        <h3>Register New User</h3>
                        <div class="form-group">
                            <label for="userName">Username:</label>
                            <input type="text" id="userName" placeholder="Enter username">
                        </div>
                        <div class="form-group">
                            <label>Photo:</label>
                            <div class="photo-capture">
                                <video id="userVideo" autoplay muted style="display: none;"></video>
                                <canvas id="userCanvas" style="display: none;"></canvas>
                                <div class="photo-preview" id="photoPreview">
                                    <span class="material-icons">camera_alt</span>
                                    <p>Click to capture photo</p>
                                </div>
                            </div>
                            <div class="photo-actions">
                                <button class="btn btn-secondary" onclick="startCamera()">Start Camera</button>
                                <button class="btn btn-primary" onclick="captureUserPhoto()">Capture Photo</button>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-success" onclick="registerUser()">Register User</button>
                            <button class="btn btn-secondary" onclick="cancelAddUser()">Cancel</button>
                        </div>
                    </div>

                    <!-- Users List -->
                    <div class="users-list">
                        <h3>Registered Users</h3>
                        <div id="usersList" class="users-container">
                            <!-- Users will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    
    <script th:src="@{/script/app.js}"></script>
</body>
</html>